<% associe = @building.company.associe.split(",").map(&:strip) %>
<% if associe.include?(current_user.email) %>
  <div class="container mt-5">
    <h3 class="mt-5 text-center">Liste des appartements</h3>
    <h5 class="text-center mb-4">situés au <%= @building.address %></h5>
    <p> <%= link_to "Ajouter un appartement", new_building_apartment_path(@building) %></p>
    <p><%= link_to "Retour", company_path(@building.company)  %></p>
    <% unless @apartments == [] %>
      <div class="row">
        <div class="p-3 col-12 col-md-6 offset-md-3 mt-4">
          <div class="border p-3">
            <p style="font-weight: bolder">Chiffres pour l'année <%= Date.today.year %></p>
            <p class="mb-1">Total loyers encaissés : <%= '%.0f' % (@building_sum_rent_paid + @building_sum_service_charge_paid) %> €</p>
            <p class="mb-1">Total loyers manquant : <%= '%.0f' % @building_solde %> €</p>
            <p class="mb-1">Total loyers attendus pour <%= Date.today.year %> : <%= '%.0f' % @building_loyer_annuel  %> €</p>
            <% if @building_loyer_annuel != 0 && @building_loyer_annuel != nil  %>
              <p>% atteint : <%= '%.2f' % ((@building_sum_rent_paid + @building_sum_service_charge_paid) / @building_loyer_annuel * 100)  %> %</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    <% counter = 1 %>
    <% @apartments.each do |apartment| %>
      <!-- ------------------------- -->
      <div class="row">
        <div class="p-3 col-12 col-md-6 offset-md-3 mt-4">
          <div class="border p-3">
            <p style="font-weight: bolder">Appartement <%= counter %></p>
            <p><%= apartment.name %></p>
            <p>Numéro du compteur d'eau : <%= apartment.water %></p>
            <p class="mb-1">Statut : <%= apartment.statut %></p>
            <div class="mt-3">
              <%= link_to "Voir", apartment_path(apartment)  %>
              <%= link_to "Modifier", edit_apartment_path(apartment)  %>
              <%= link_to "Supprimer", apartment_path(apartment), method: :delete  %>
            </div>
          </div>
        </div>
      </div>
      <% counter += 1 %>
    <% end %>
  </div>
<% else %>
  <h3 class="text-center my-5" style="color:red">Vous n'avez pas accès à cette page</h3>
<% end %>