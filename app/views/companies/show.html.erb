<% associe = @company.associe.split(",").map(&:strip) %>
<% if associe.include?(current_user.email) %>
  <div class="container mt-5">
    <h3 class="text-center mt-5">Liste de vos batiments </h3>
    <h5 class="text-center mb-4">de la société <%= @company.name %></h5>
    <p> <%= link_to "Ajouter un batiment", new_company_building_path(@company) %></p>
    <p><%= link_to "Retour", companies_path %></p>
    <% unless @buildings == [] %>
      <div class="row">
        <div class="p-3 col-12 col-md-6 offset-md-3 mt-4">
          <div class="border p-3">
            <p style="font-weight: bolder">Chiffres <%= Date.today.year %> : Société <%= @company.name %></p>
            <p class="mb-1">Total loyers encaissés : <%= '%.0f' % (@company_building_sum_rent_paid + @company_building_sum_service_charge_paid) %> €</p>
            <p class="mb-1">Total loyers manquant : <%= '%.0f' % @company_building_solde %> €</p>
            <p class="mb-1">Total loyers attendus pour <%= Date.today.year %> : <%= '%.0f' % @building_loyer_annuel  %> €</p>
            <% if @company_building_loyer_annuel != 0 && @company_building_loyer_annuel != nil  %>
              <p>% atteint : <%= '%.2f' % ((@company_building_sum_rent_paid + @company_building_sum_service_charge_paid) / @company_building_loyer_annuel * 100)  %> %</p>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
    <% @buildings.each do |building| %>
      <div class="row">
        <div class="p-3 col-12 col-md-6 offset-md-3 mt-4">
          <div class="border p-3">
            <p><%= building.address %></p>
            <p>Nombre d'appartements : <%= building.number_of_flat %></p>
            <p>Statut : <%= building.statut %>  </p>
            <div class="mt-3">
              <%= link_to "Voir", building_path(building)  %>
              <%= link_to "Modifier", edit_building_path(building)  %>
              <%= link_to "Supprimer", building_path(building), method: :delete  %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <h3 class="text-center my-5" style="color:red">Vous n'avez pas accès à cette page</h3>
<% end %>